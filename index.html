<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TigroIA</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(to bottom, #f0f4f8, #d9e2ec);
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h1 { color: #0a3d62; margin-bottom: 20px; }
  #contador { margin-bottom: 10px; color: #2d3436; font-weight: bold; }
  #chat {
    width: 100%; max-width: 600px; height: 400px;
    border: 2px solid #0a3d62; border-radius: 10px; background: #fff;
    overflow-y: auto; padding: 15px; margin-bottom: 10px;
  }
  .user { color: #0984e3; margin: 5px 0; }
  .bot { color: #00b894; margin: 5px 0; }
  #inputArea { display: flex; gap: 10px; width: 100%; max-width: 600px; }
  select, input, button {
    padding: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px;
  }
  input { flex: 1; }
  button {
    background: #0a3d62; color: white; border: none; cursor: pointer; transition: 0.2s;
  }
  button:hover { background: #06547c; }
</style>
</head>
<body>

<h1>TigroIA</h1>
<div id="contador">Mensagens: 0</div>
<div id="chat"></div>
<div id="inputArea">
  <select id="plano">
    <option value="free">Free</option>
    <option value="pro">Pro</option>
  </select>
  <input type="text" id="input" placeholder="Digite sua mensagem...">
  <button onclick="enviar()">Enviar</button>
</div>

<script>
const chatDiv = document.getElementById("chat");
const contadorDiv = document.getElementById("contador");
let freeCount = 0;

async function enviar() {
  const mensagem = document.getElementById("input").value.trim();
  const plano = document.getElementById("plano").value;
  if (!mensagem) return;

  if (plano === "free" && freeCount >= 100) {
    chatDiv.innerHTML += `<p class="bot"><strong>TigroIA:</strong> Limite da versão Free atingido.</p>`;
    return;
  }
  if (plano === "free") freeCount++;
  contadorDiv.textContent = `Mensagens: ${freeCount}`;

  chatDiv.innerHTML += `<p class="user"><strong>Você:</strong> ${mensagem}</p>`;
  document.getElementById("input").value = "";
  chatDiv.scrollTop = chatDiv.scrollHeight;

  try {
    const respostaAPI = await fetch("/api/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ mensagem, plano })
    });

    const data = await respostaAPI.json();
    chatDiv.innerHTML += `<p class="bot"><strong>TigroIA:</strong> ${data.resposta}</p>`;
    chatDiv.scrollTop = chatDiv.scrollHeight;

  } catch {
    chatDiv.innerHTML += `<p class="bot"><strong>TigroIA:</strong> Erro: sem resposta da IA.</p>`;
    chatDiv.scrollTop = chatDiv.scrollHeight;
  }
}
</script>

</body>
</html>
